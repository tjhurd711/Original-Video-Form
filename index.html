<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customize Your Memorial Video</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" 
        href="https://www.dropbox.com/scl/fi/7tqrvmnchu17tkatqa9l5/MemorialVideoAI-Favicon.svg?rlkey=5cj4gwyhq3frrupo1g1d3y8so&st=znzwkpy9&raw=1">

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <div class="container">
    <div class="header">
      <img src="images/logo.png" alt="Memorial Video Logo" class="header-logo">
      <h1 id="headerTitle">‚ú® Customize Your Memorial Video</h1>
      <p>Review your final slideshow and choose your video preferences below</p>
    </div>
    
    <div class="content">
      <div class="intro-box">
        <h2>üìã Next Steps</h2>
        <p>We've created a draft slideshow from your photos. Please select your video settings below and confirm that we have your final slideshow link. Once you submit, we'll create your memorial video and send it to you via email in 5-15 minutes.</p>
      </div>
      
      <!-- SECTION 1: Slideshow Confirmation -->
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üìä</span>
          <span class="section-title">Confirm Your Slideshow</span>
        </div>
        
        <div class="info-box blue">
          We've prepared a draft slideshow for you. Please confirm which version you'd like to use for your video.
        </div>
        
        <div class="form-group">
          <label>
            Did you edit the document using the link shared by MemorialVideo.AI? Or, did you make a copy/download a separate version?
            <div class="help-text">Note: If you did not actively press "make a copy" or "download", then you likely edited the slideshow document provided.</div>
          </label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="slideshowVersion" value="original" checked>
              <span class="radio-option-label">I edited the document using the link provided</span>
              <div class="radio-option-content">
                <span class="radio-option-desc">Use the original slideshow that was shared</span>
              </div>
            </label>
            
            <label class="radio-option">
              <input type="radio" name="slideshowVersion" value="copy">
              <span class="radio-option-label">I made a Goolge Slides copy and have a new link</span>
              <div class="radio-option-content">
                <span class="radio-option-desc">Provide a new Google Slides URL (e.g., slideshow_v2)</span>
                <div class="conditional-input" id="copyUrlInput" style="display:none;">
                  <label for="newGoogleSlidesUrl" style="font-size: 13px; margin-bottom: 6px;">New Google Slides URL:</label>
                  <input type="url" id="newGoogleSlidesUrl" name="newGoogleSlidesUrl" placeholder="https://docs.google.com/presentation/d/...">
                </div>
              </div>
            </label>
            
            <label class="radio-option">
              <input type="radio" name="slideshowVersion" value="download">
              <span class="radio-option-label">I downloaded a version to my PC/have a new powerpoint URL</span>
              <div class="radio-option-content">
                <span class="radio-option-desc">Upload your PowerPoint file (.pptx) or provide a PowerPoint URL</span>
                <div class="conditional-input" id="downloadInput" style="display:none;">
                  <!-- Sub-choice: File or URL -->
                  <div style="margin-bottom: 12px;">
                    <label style="font-size: 14px; font-weight: 600; color: #555; display: block; margin-bottom: 8px;">How would you like to provide your PowerPoint?</label>
                    
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer;">
                      <input type="radio" name="pptxMethod" value="file" style="width: 18px; height: 18px;">
                      <span style="font-weight: 600; font-size: 14px;">Upload File</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; cursor: pointer;">
                      <input type="radio" name="pptxMethod" value="url" style="width: 18px; height: 18px;">
                      <span style="font-weight: 600; font-size: 14px;">Provide URL</span>
                    </label>
                  </div>
                  
                  <!-- File Upload Section -->
                  <div id="pptxFileSection" style="display:none; margin-bottom: 12px;">
                    <label for="pptxFile" style="font-size: 13px; margin-bottom: 6px; display: block;">Upload PowerPoint File:</label>
                    <input type="file" id="pptxFile" name="pptxFile" accept=".pptx,application/vnd.openxmlformats-officedocument.presentationml.presentation">
                  </div>
                  
                  <!-- URL Section -->
                  <div id="pptxUrlSection" style="display:none;">
                    <label for="pptxUrl" style="font-size: 13px; margin-bottom: 6px; display: block;">PowerPoint URL (OneDrive/SharePoint):</label>
                    <input type="url" id="pptxUrl" name="pptxUrl" placeholder="https://onedrive.live.com/... or https://sharepoint.com/...">
                  </div>
                </div>
              </div>
            </label>
          </div>
        </div>
        
<!-- Slideshow Preview (Conditional) -->
        <div id="slideshowPreview" class="preview-section" style="display:none;">
          <div class="preview-header" id="previewHeader">
            üîç Preview: Slideshow
          </div>
          <iframe id="previewIframe" class="preview-iframe" src="" frameborder="0"></iframe>
          <div style="margin-top: 20px; text-align: center;">
            <a id="editSlidesButton" href="" target="_blank" 
               style="display: inline-block; 
                      padding: 14px 28px; 
                      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                      color: white; 
                      text-decoration: none; 
                      border-radius: 8px; 
                      font-weight: 600; 
                      font-size: 16px;
                      transition: all 0.3s;
                      box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.4)';"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)';">
              üé® Edit My Slides (edits will auto-save)
            </a>
            <button onclick="refreshPreview()"
                    style="display: inline-block; 
                           padding: 14px 28px; 
                           background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                           color: white; 
                           text-decoration: none; 
                           border-radius: 8px; 
                           font-weight: 600; 
                           font-size: 16px;
                           transition: all 0.3s;
                           box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
                           border: none;
                           cursor: pointer;
                           margin-left: 12px;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.4)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)';">
              üîÑ Refresh Preview
            </button>
          </div>
        </div>
        
        <!-- PowerPoint File Preview (Filename only) -->
        <div id="pptxFilePreview" class="preview-section" style="display:none; background: #fff9e6; border-color: #FF9800;">
          <div class="preview-header" style="color: #e65100;">
            üìÑ PowerPoint File Selected
          </div>
          <div style="padding: 15px; background: white; border-radius: 8px; font-weight: 600; color: #333;">
            <span id="pptxFileName"></span>
          </div>
        </div>
      </div>
      
      <!-- SECTION 2: Choose Music -->
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üéµ</span>
          <span class="section-title">Choose Your Music</span>
        </div>
        
        <div class="library-section">
          <div class="library-header">
            üéº Select Royalty Free Songs to add to your video (you can update the song order below)
          </div>
          <div style="margin-bottom: 15px;">
            <label for="genreSelect" style="font-weight: 600; color: #2196F3; margin-bottom: 6px; display: block;">Select Genre:</label>
            <select id="genreSelect" style="padding: 10px; border: 2px solid #FF9800; border-radius: 8px; font-size: 14px; font-weight: 600; background: white; cursor: pointer; width: 200px;">
              <option value="Classical">Classical</option>
              <option value="Pop/Folk/Celtic">Pop/Folk/Celtic</option>
              <option value="Country">Country</option>
              <option value="Gospel">Gospel</option>
              <option value="Uplifting">Uplifting</option>
            </select>
          </div>
          <div class="library-grid" id="libraryGrid">
            <!-- Populated by JS -->
          </div>
        </div>

        <div class="upload-section" id="uploadSection">
          <label class="upload-label" id="uploadLabel">
            üì§ Upload Your Own Songs (MP3)
          </label>
          <input type="file" id="customSongUpload" accept=".mp3,audio/mpeg" multiple style="display: none;">
          <div style="margin-top: 8px; font-size: 13px; color: #666;">
            <span id="songCountDisplay">0 songs selected</span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Your Selected Songs (max 6 total). Click ‚Äúup‚Äù or ‚Äúdown‚Äù arrows to change song order.</label>
          <div id="songList" class="song-list">
            <!-- Populated by JS -->
          </div>
        </div>
        
      <!-- SECTION 3: Video Timing -->
      <div class="section">
        <div class="section-header">
          <span class="section-icon">‚è±Ô∏è</span>
          <span class="section-title">Video Timing</span>
        </div>

        <div class="form-group">
          <label>How should we time your video?</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="timingMode" value="perSlide">
              <span class="radio-option-label">Set Seconds Per Slide</span>
              <div class="radio-option-content">
                <span class="radio-option-desc">Great for scene timing (normal range 5-7 seconds per slide)</span>
                <div class="conditional-input" id="perSlideInput" style="display:none;">
                  <label for="perSlideSec" style="font-size: 13px; margin-bottom: 6px;">Seconds per slide:</label>
                  <input type="number" id="perSlideSec" name="perSlideSec" min="2" max="30" value="5">
                </div>
              </div>
            </label>
            
            <label class="radio-option selected">
              <input type="radio" name="timingMode" value="fixedRuntime" checked>
              <span class="radio-option-label">Set a total video runtime (i.e. 10 minutes)</span>
              <div class="radio-option-content">
                <span class="radio-option-desc">Great for meeting event agenda time requirements</span>
                <div class="conditional-input" id="fixedRuntimeInput">
                  <label style="font-size: 13px; margin-bottom: 6px;">Total runtime:</label>
                  <div class="runtime-row total-runtime-inputs">
                    <select id="fixedRuntimeMinutes" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 15px;">
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6" selected>6</option>
                      <option value="7">7</option>
                      <option value="8">8</option>
                      <option value="9">9</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                      <option value="13">13</option>
                      <option value="14">14</option>
                      <option value="15">15</option>
                      <option value="16">16</option>
                      <option value="17">17</option>
                      <option value="18">18</option>
                      <option value="19">19</option>
                      <option value="20">20</option>
                    </select>
                    <span style="font-weight: 600; color: #555;">minutes</span>
                    <select id="fixedRuntimeSeconds" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 15px;">
                      <option value="0" selected>00</option>
                      <option value="30">30</option>
                    </select>
                    <span style="font-weight: 600; color: #555;">seconds</span>
                  </div>
                </div>
              </div>
            </label>
            
            <label class="radio-option">
              <input type="radio" name="timingMode" value="fitToSongs">
              <span class="radio-option-label">Set video length to the full runtime of my songs</span>
              <div class="radio-option-content">
                <span class="radio-option-desc">Perfect for those who do not want partial songs</span>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Duration Display -->
      <div id="durationDisplay" class="preview-section" style="display:none; background: #e8f5e9; border-color: #4CAF50; margin-top: 20px;">
        <div class="preview-header" style="color: #2e7d32;">
         ‚è±Ô∏è Estimated Video Duration
       </div>
       <div style="padding: 15px; background: white; border-radius: 8px;">
         <div style="font-size: 32px; font-weight: 700; color: #4CAF50; text-align: center;" id="durationValue">
           --:--
         </div>
         <div style="font-size: 14px; color: #666; text-align: center; margin-top: 8px;" id="durationDetails">
           Enter slide count to calculate
         </div>
       </div>
     </div>
      
      <!-- SECTION 4: Transitions -->
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üé®</span>
          <span class="section-title">Transition Style</span>
        </div>

        <div class="transition-container">
          <!-- Left side: Dropdown -->
          <div class="transition-dropdown">
            <div class="form-group" style="margin-bottom: 0;">
              <label for="visualPackage">
                Visual Package
                <div class="help-text">Choose the style of transitions between slides</div>
              </label>
              <select id="visualPackage" name="visualPackage">
                <option value="simple-fade-wipe">Simple Fade & Wipe</option>
                <option value="pages-of-life">Pages of Life</option>
                <option value="floating-frames">Floating Frames</option>
                <option value="zoom-through">Zoom Through</option>
                <option value="blinds-combs-bars">Blinds, Combs & Bars</option>
              </select>
            </div>
          </div>
          
          <!-- Right side: Video Preview -->
          <div class="transition-preview">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555; font-size: 14px;">
              Preview
            </label>
            <div style="background: #000; border-radius: 8px; overflow: hidden;">
              <video id="transitionPreview" controls preload="metadata" playsinline style="width: 100%; display: block;">
                <source id="transitionPreviewSource" src="https://www.dropbox.com/scl/fi/ij0b9ndn9mcg2me0ipb7y/Transition-Examples-Simple-Fade-and-Wipe-2.mp4?rlkey=pgrt4ad1qg3wy9203pv6c32zm&st=j9cme2mi&raw=1" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>
          </div>
        </div>
      </div>
      
      <!-- SECTION 5: Music Distribution -->
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üéº</span>
          <span class="section-title">Music Distribution</span>
        </div>
        
        <div class="form-group">
          <label for="musicDistribution">
            How should songs be distributed?
            <div class="help-text">Choose how your selected songs play throughout the video</div>
          </label>
          <select id="musicDistribution" name="musicDistribution">
            <option value="evenlyDistributed">Evenly Distributed (Recommended)</option>
            <option value="specifyPlacement">Specify Placement (Advanced)</option>
          </select>
        </div>

        <!-- Conditional Song Range Sliders -->
        <div id="songRangesContainer" class="song-ranges-container" style="display:none;">
          <div class="info-box">
            üìç Specify which slides each song should play during. The backend will automatically prevent overlaps and fill gaps.
          </div>
          <div id="songRangesList">
            <!-- Will be populated dynamically based on number of songs -->
          </div>
        </div>
      </div>
      
      <!-- SUBMIT SECTION -->
      <div class="submit-section">
        <button id="submitBtn" class="btn-submit" onclick="calculateVideo()" disabled>
          üìä Review My Video Plan (Submit)
        </button>
        
        <p class="submit-note" style="color: #667eea;">
          We'll calculate your video length and show you a preview before creating it
        </p>
        
        <div id="validationMessage" class="validation-message" style="display:none;"></div>
      </div>
    </div>
  </div>
  
  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- NEW CALCULATION MODAL GOES HERE -->
  <div id="calculationModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üìä Your Current Video Plan</h2>
      </div>
      
      <div class="modal-body">
        <div class="calc-result-item">
          <span class="calc-label">Slide Count:</span>
          <span class="calc-value" id="modalSlideCount">--</span>
        </div>
        
        <div class="calc-result-item">
          <span class="calc-label">Estimated Duration:</span>
          <span class="calc-value" id="modalDuration">--</span>
        </div>
        
        <div class="calc-summary" id="modalSummary">
          Calculating...
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="modal-btn modal-btn-secondary" onclick="closeCalculationModal()">
          ‚Üê Make Another Update
        </button>
        <button class="modal-btn modal-btn-primary" onclick="finalSubmit()">
          Create This Video ‚úì
        </button>
      </div>
    </div>
  </div>
  
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <div class="loading-text">Creating Your Video...</div>
      <div class="loading-subtext">Please wait, this may take a few moments</div>
    </div>
  </div>

  <!-- Music Upload Terms Modal -->
  <div id="musicTermsModal" class="terms-modal-overlay">
    <div class="terms-modal-content">
      <div class="terms-modal-header">
        <h2>‚ö†Ô∏è User Uploaded Music</h2>
      </div>
    
      <div class="terms-modal-body">
        <p>By clicking "Agree and Accept," you confirm that you have the legal right to upload and publicly display all content (including photos, videos, and music) in your memorial video.</p>
      
        <p>You agree that Memorial Video AI is not responsible for any copyright or other legal issues arising from content you upload, and you will protect and reimburse Memorial Video AI for any claims, costs, or damages (including legal fees) that result from your uploaded content violating someone else's rights.</p>
      </div>
    
      <div class="terms-modal-footer">
        <button class="terms-btn terms-btn-cancel" onclick="cancelMusicUpload()">
          Cancel Upload
        </button>
        <button class="terms-btn terms-btn-accept" onclick="acceptMusicTerms()">
          Agree and Accept
        </button>
      </div>
    </div>
  </div>
      
  <script src="js/main.js"></script>
    </body>
    </html>
